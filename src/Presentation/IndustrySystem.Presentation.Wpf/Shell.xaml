<Window x:Class="IndustrySystem.Presentation.Wpf.Shell"
 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
 xmlns:ui="http://schemas.modernwpf.com/2019"
 xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
 xmlns:local="clr-namespace:IndustrySystem.Presentation.Wpf"
 xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
 xmlns:res="clr-namespace:IndustrySystem.Presentation.Wpf.Resources"
 xmlns:conv="clr-namespace:IndustrySystem.Presentation.Wpf.Converters"
 xmlns:prism="http://prismlibrary.com/"
 xmlns:s="clr-namespace:IndustrySystem.Presentation.Wpf.Services"
 ui:WindowHelper.UseModernWindowStyle="True"
 ui:TitleBar.ExtendViewIntoTitleBar="True"
 ui:TitleBar.IsBackButtonVisible="False"
 Title="{Binding [App_Title], Source={StaticResource Loc}}"
 Height="800" Width="1280"
 WindowStartupLocation="CenterScreen"
 MinHeight="600" MinWidth="900"
 Background="{DynamicResource SystemControlPageBackgroundAltHighBrush}">

    <Window.Resources>
        <res:LocalizationProvider x:Key="Loc" />
        <conv:PermissionToVisibilityConverter x:Key="PermissionToVisibility"/>
        
        <!-- ç§‘æŠ€æ„Ÿæ¸å˜èƒŒæ™¯ -->
        <LinearGradientBrush x:Key="TechGradientBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#0F1419" Offset="0"/>
            <GradientStop Color="#1A2332" Offset="0.5"/>
            <GradientStop Color="#0F1419" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- Accent æ¸å˜ -->
        <LinearGradientBrush x:Key="AccentGradientBrush" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#0078D4" Offset="0"/>
            <GradientStop Color="#00BCF2" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- å‘å…‰æ•ˆæžœ -->
        <DropShadowEffect x:Key="GlowEffect" 
                          Color="#0078D4" 
                          BlurRadius="20" 
                          ShadowDepth="0" 
                          Opacity="0.6"/>
        
        <!-- å¡ç‰‡é˜´å½± -->
        <DropShadowEffect x:Key="CardShadow" 
                          Color="Black" 
                          BlurRadius="10" 
                          ShadowDepth="2" 
                          Opacity="0.3"/>
        
        <!-- åŠ¨ç”»æ ·å¼ -->
        <Style x:Key="FadeInAnimation" TargetType="FrameworkElement">
            <Style.Triggers>
                <EventTrigger RoutedEvent="Loaded">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                           From="0" To="1" Duration="0:0:0.5"
                                           DecelerationRatio="0.7"/>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <!-- æ ‡é¢˜æ åŒºåŸŸ -->
        <Grid Height="48" VerticalAlignment="Top" 
              Background="{StaticResource TechGradientBrush}">
            <Grid.Effect>
                <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.4" Color="Black"/>
            </Grid.Effect>
            
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Logo å’Œæ ‡é¢˜ -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="16,0,0,0">
                <Border Width="32" Height="32" CornerRadius="6"
                        Background="{StaticResource AccentGradientBrush}"
                        VerticalAlignment="Center">
                    <Border.Effect>
                        <DropShadowEffect Color="#0078D4" BlurRadius="12" ShadowDepth="0" Opacity="0.8"/>
                    </Border.Effect>
                    <ui:FontIcon Glyph="&#xE950;" FontSize="18" 
                                 Foreground="White" 
                                 HorizontalAlignment="Center" 
                                 VerticalAlignment="Center"/>
                </Border>
                <TextBlock Text="{Binding [App_Title], Source={StaticResource Loc}}" 
                          FontSize="16" FontWeight="SemiBold"
                          Foreground="White"
                          VerticalAlignment="Center" 
                          Margin="12,0,0,0"/>
            </StackPanel>
            
            <!-- å³ä¾§å·¥å…·æ  -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" 
                       Margin="0,0,140,0" VerticalAlignment="Center">
                <!-- ä¸»é¢˜åˆ‡æ¢ -->
                <ui:ToggleSwitch x:Name="ThemeToggle" 
                                OnContent="ðŸŒ™" OffContent="â˜€ï¸"
                                Toggled="ThemeToggle_Toggled"
                                Margin="0,0,12,0"/>
                
                <!-- ç”¨æˆ·ä¿¡æ¯ -->
                <Border Background="#20FFFFFF" 
                        CornerRadius="20" 
                        Padding="12,6"
                        Margin="8,0">
                    <StackPanel Orientation="Horizontal">
                        <Border Width="28" Height="28" CornerRadius="14"
                                Background="{StaticResource AccentGradientBrush}"
                                Margin="0,0,8,0">
                            <ui:FontIcon Glyph="&#xE77B;" 
                                        FontSize="14" 
                                        Foreground="White"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="{Binding CurrentUserName}" 
                                  Foreground="White" 
                                  FontWeight="Medium"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
                
                <!-- ç™»å‡ºæŒ‰é’® -->
                <Button Click="OnLogoutClick" 
                        Background="Transparent"
                        BorderThickness="0"
                        Width="36" Height="36"
                        ToolTip="ç™»å‡º"
                        Margin="4,0,0,0">
                    <ui:FontIcon Glyph="&#xF3B1;" 
                                FontSize="16" 
                                Foreground="#FFE0E0E0"/>
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#30FFFFFF"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Grid>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <ui:NavigationView x:Name="NavView" 
                          Margin="0,48,0,0"
                          IsSettingsVisible="False"
                          PaneDisplayMode="Left"
                          IsPaneOpen="True"
                          OpenPaneLength="240"
                          CompactPaneLength="56"
                          IsBackButtonVisible="Collapsed"
                          Background="Transparent">
            
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Loaded">
                    <i:InvokeCommandAction Command="{Binding OnLoadedCommand}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction Command="{Binding NavSelectionChangedCommand}" PassEventArgsToCommand="True"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>

            <ui:NavigationView.MenuItems>
                <!-- è¿è¡Œçœ‹æ¿ -->
                <ui:NavigationViewItem Content="{Binding [Nav_RunDashboard], Source={StaticResource Loc}}">
                    <ui:NavigationViewItem.Icon>
                        <ui:FontIcon Glyph="&#xE80F;" Foreground="#00BCF2"/>
                    </ui:NavigationViewItem.Icon>
                    <ui:NavigationViewItem.MenuItems>
                        <ui:NavigationViewItem Content="{Binding [Nav_RunExperiment], Source={StaticResource Loc}}" Tag="RunExperiment">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE768;" Foreground="#0078D4"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                        <ui:NavigationViewItem Content="{Binding [Nav_RealtimeData], Source={StaticResource Loc}}" Tag="RealtimeData">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE9D2;" Foreground="#00BCF2"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                        <ui:NavigationViewItem Content="å‘Šè­¦ç›‘æŽ§" Tag="Alarm">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE7BA;" Foreground="#FF4444"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                    </ui:NavigationViewItem.MenuItems>
                </ui:NavigationViewItem>

                <ui:NavigationViewItemSeparator/>

                <!-- å®žéªŒç®¡ç† -->
                <ui:NavigationViewItem Content="{Binding [Nav_ExperimentManagement], Source={StaticResource Loc}}">
                    <ui:NavigationViewItem.Icon>
                        <ui:FontIcon Glyph="&#xE8F1;" Foreground="#10893E"/>
                    </ui:NavigationViewItem.Icon>
                    <ui:NavigationViewItem.Visibility>
                        <MultiBinding Converter="{StaticResource PermissionToVisibility}">
                            <Binding Path="AuthState"/>
                            <Binding><Binding.Source>Experiments.View</Binding.Source></Binding>
                            <Binding><Binding.Source>Templates.View</Binding.Source></Binding>
                            <Binding><Binding.Source>Templates.Edit</Binding.Source></Binding>
                        </MultiBinding>
                    </ui:NavigationViewItem.Visibility>
                    <ui:NavigationViewItem.MenuItems>
                        <ui:NavigationViewItem Content="{Binding [Nav_Templates], Source={StaticResource Loc}}" Tag="Templates">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE8A5;" Foreground="#107C10"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                        <ui:NavigationViewItem Content="{Binding [Nav_ExperimentConfig], Source={StaticResource Loc}}" Tag="ExperimentConfig">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE9E9;" Foreground="#10893E"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                        <ui:NavigationViewItem Content="{Binding [Nav_ExperimentGroupConfig], Source={StaticResource Loc}}" Tag="ExperimentGroupConfig">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE71D;" Foreground="#107C10"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                    </ui:NavigationViewItem.MenuItems>
                </ui:NavigationViewItem>

                <!-- ç‰©æ–™ç®¡ç† -->
                <ui:NavigationViewItem Content="{Binding [Nav_MaterialManagement], Source={StaticResource Loc}}">
                    <ui:NavigationViewItem.Icon>
                        <ui:FontIcon Glyph="&#xE7B8;" Foreground="#FF8C00"/>
                    </ui:NavigationViewItem.Icon>
                    <ui:NavigationViewItem.Visibility>
                        <MultiBinding Converter="{StaticResource PermissionToVisibility}">
                            <Binding Path="AuthState"/>
                            <Binding><Binding.Source>Material.View</Binding.Source></Binding>
                            <Binding><Binding.Source>Inventory.View</Binding.Source></Binding>
                        </MultiBinding>
                    </ui:NavigationViewItem.Visibility>
                    <ui:NavigationViewItem.MenuItems>
                        <ui:NavigationViewItem Content="{Binding [Nav_MaterialInfo], Source={StaticResource Loc}}" Tag="MaterialInfo">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE8EC;" Foreground="#FF8C00"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                        <ui:NavigationViewItem Content="{Binding [Nav_ShelfInfo], Source={StaticResource Loc}}" Tag="ShelfInfo">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE81E;" Foreground="#CA5010"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                        <ui:NavigationViewItem Content="{Binding [Nav_Inventory], Source={StaticResource Loc}}" Tag="Inventory">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE8B7;" Foreground="#FF8C00"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                    </ui:NavigationViewItem.MenuItems>
                </ui:NavigationViewItem>

                <ui:NavigationViewItemSeparator/>

                <!-- æ•°æ®ç®¡ç† -->
                <ui:NavigationViewItem Content="{Binding [Nav_DataManagement], Source={StaticResource Loc}}">
                    <ui:NavigationViewItem.Icon>
                        <ui:FontIcon Glyph="&#xE8B7;" Foreground="#8764B8"/>
                    </ui:NavigationViewItem.Icon>
                    <ui:NavigationViewItem.Visibility>
                        <MultiBinding Converter="{StaticResource PermissionToVisibility}">
                            <Binding Path="AuthState"/>
                            <Binding><Binding.Source>Admin</Binding.Source></Binding>
                            <Binding><Binding.Source>SuperAdmin</Binding.Source></Binding>
                        </MultiBinding>
                    </ui:NavigationViewItem.Visibility>
                    <ui:NavigationViewItem.MenuItems>
                        <ui:NavigationViewItem Content="{Binding [Nav_ExperimentHistory], Source={StaticResource Loc}}" Tag="ExperimentHistory">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE81C;" Foreground="#8764B8"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                        <ui:NavigationViewItem Content="{Binding [Nav_OperationLogs], Source={StaticResource Loc}}" Tag="OperationLogs">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE8BC;" Foreground="#8764B8"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                    </ui:NavigationViewItem.MenuItems>
                </ui:NavigationViewItem>

                <!-- è®¾å¤‡ç®¡ç† -->
                <ui:NavigationViewItem Content="{Binding [Nav_DeviceManagement], Source={StaticResource Loc}}">
                    <ui:NavigationViewItem.Icon>
                        <ui:FontIcon Glyph="&#xECAA;" Foreground="#E74856"/>
                    </ui:NavigationViewItem.Icon>
                    <ui:NavigationViewItem.Visibility>
                        <MultiBinding Converter="{StaticResource PermissionToVisibility}">
                            <Binding Path="AuthState"/>
                            <Binding><Binding.Source>Admin</Binding.Source></Binding>
                            <Binding><Binding.Source>Device.Maintain</Binding.Source></Binding>
                        </MultiBinding>
                    </ui:NavigationViewItem.Visibility>
                    <ui:NavigationViewItem.MenuItems>
                        <ui:NavigationViewItem Content="{Binding [Nav_ManualDebug], Source={StaticResource Loc}}" Tag="ManualDebug">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE9D9;" Foreground="#E74856"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                        <ui:NavigationViewItem Content="{Binding [Nav_DeviceParams], Source={StaticResource Loc}}" Tag="DeviceParams">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE713;" Foreground="#C50F1F"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                    </ui:NavigationViewItem.MenuItems>
                </ui:NavigationViewItem>

                <ui:NavigationViewItemSeparator/>

                <!-- ç³»ç»Ÿç®¡ç† -->
                <ui:NavigationViewItem Content="{Binding [Nav_SystemManagement], Source={StaticResource Loc}}">
                    <ui:NavigationViewItem.Icon>
                        <ui:FontIcon Glyph="&#xE115;" Foreground="#FFB900"/>
                    </ui:NavigationViewItem.Icon>
                    <ui:NavigationViewItem.Visibility>
                        <MultiBinding Converter="{StaticResource PermissionToVisibility}">
                            <Binding Path="AuthState"/>
                            <Binding><Binding.Source>SuperAdmin</Binding.Source></Binding>
                            <Binding><Binding.Source>Admin</Binding.Source></Binding>
                        </MultiBinding>
                    </ui:NavigationViewItem.Visibility>
                    <ui:NavigationViewItem.MenuItems>
                        <ui:NavigationViewItem Content="{Binding [Nav_Users], Source={StaticResource Loc}}" Tag="Users">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE77B;" Foreground="#FFB900"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                        <ui:NavigationViewItem Content="{Binding [Nav_Roles], Source={StaticResource Loc}}" Tag="Roles">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE716;" Foreground="#FFB900"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                        <ui:NavigationViewItem Content="{Binding [Nav_Permissions], Source={StaticResource Loc}}" Tag="Permissions">
                            <ui:NavigationViewItem.Icon>
                                <ui:FontIcon Glyph="&#xE72E;" Foreground="#FFB900"/>
                            </ui:NavigationViewItem.Icon>
                        </ui:NavigationViewItem>
                    </ui:NavigationViewItem.MenuItems>
                </ui:NavigationViewItem>
            </ui:NavigationView.MenuItems>

            <!-- å†…å®¹åŒºåŸŸå¸¦å¡ç‰‡æ•ˆæžœ -->
            <Border CornerRadius="8" 
                    Margin="8"
                    Background="{DynamicResource SystemControlPageBackgroundAltHighBrush}">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.2" Color="Black"/>
                </Border.Effect>
                
                <Grid>
                    <materialDesign:DialogHost Identifier="RootDialogHost">
                        <ContentControl x:Name="MainRegionHost" 
                                       Margin="16" 
                                       Content="{Binding CurrentContent}"
                                       Style="{StaticResource FadeInAnimation}"/>
                    </materialDesign:DialogHost>
                </Grid>
            </Border>
        </ui:NavigationView>
    </Grid>
</Window>
